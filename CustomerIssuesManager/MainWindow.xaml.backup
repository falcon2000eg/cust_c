<Window x:Class="CustomerIssuesManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="نظام إدارة مشاكل العملاء - النسخة المحسنة" 
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        Background="#f8f9fa"
        Loaded="MainWindow_Loaded">
    
    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- Colors -->
        <SolidColorBrush x:Key="BgMain" Color="#f8f9fa"/>
        <SolidColorBrush x:Key="BgCard" Color="#f0f6fa"/>
        <SolidColorBrush x:Key="BgLight" Color="#ffffff"/>
        <SolidColorBrush x:Key="Header" Color="#2c3e50"/>
        <SolidColorBrush x:Key="HeaderText" Color="White"/>
        <SolidColorBrush x:Key="ButtonSave" Color="#27ae60"/>
        <SolidColorBrush x:Key="ButtonDelete" Color="#e74c3c"/>
        <SolidColorBrush x:Key="ButtonAction" Color="#3498db"/>
        <SolidColorBrush x:Key="ButtonSecondary" Color="#95a5a6"/>
        <SolidColorBrush x:Key="ButtonWarning" Color="#f39c12"/>
        <SolidColorBrush x:Key="TextMain" Color="#222"/>
        <SolidColorBrush x:Key="TextSubtle" Color="#7f8c8d"/>
        <SolidColorBrush x:Key="BorderLight" Color="#e0e0e0"/>
        <SolidColorBrush x:Key="Success" Color="#27ae60"/>
        <SolidColorBrush x:Key="Warning" Color="#f39c12"/>
        <SolidColorBrush x:Key="Error" Color="#e74c3c"/>
        <SolidColorBrush x:Key="Info" Color="#3498db"/>
        
        <!-- Status Colors -->
        <SolidColorBrush x:Key="StatusNew" Color="#3498db"/>
        <SolidColorBrush x:Key="StatusInProgress" Color="#f39c12"/>
        <SolidColorBrush x:Key="StatusSolved" Color="#27ae60"/>
        <SolidColorBrush x:Key="StatusClosed" Color="#95a5a6"/>
        
        <!-- Fonts -->
        <FontFamily x:Key="HeaderFont">Arial</FontFamily>
        <FontFamily x:Key="NormalFont">Arial</FontFamily>
        <FontFamily x:Key="ButtonFont">Arial</FontFamily>
        
        <!-- Styles -->
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="{StaticResource HeaderFont}"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource HeaderText}"/>
        </Style>
        
        <Style x:Key="NormalTextStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="{StaticResource NormalFont}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
        </Style>
        
        <Style x:Key="NormalLabelStyle" TargetType="Label">
            <Setter Property="FontFamily" Value="{StaticResource NormalFont}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
        </Style>
        
        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="FontFamily" Value="{StaticResource ButtonFont}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="{StaticResource ButtonSave}"/>
        </Style>
        
        <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="{StaticResource ButtonAction}"/>
        </Style>
        
        <Style x:Key="AccessibleButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="AutomationProperties.IsOffscreenBehavior" Value="OnScreen"/>
        </Style>
        
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BgCard}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        
        <!-- Enhanced Search Styles -->
        <Style x:Key="SearchCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BgLight}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                        Margin="12,8"
                                        VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="SearchButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource ButtonAction}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="ResultsSummaryStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource TextSubtle}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,10,0,0"/>
        </Style>
        
        <!-- Enhanced Case List Styles -->
        <Style x:Key="CaseCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#80000000" Direction="270" ShadowDepth="2" BlurRadius="4"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#f8f9fa"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#80000000" Direction="270" ShadowDepth="4" BlurRadius="8"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                    <Setter Property="Background" Value="#e3f2fd"/>
                    <Setter Property="BorderBrush" Value="{StaticResource ButtonAction}"/>
                    <Setter Property="BorderThickness" Value="2"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#40000000" Direction="270" ShadowDepth="6" BlurRadius="12"/>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="QuickActionStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#e3f2fd"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Tab Control Styles -->
        <Style x:Key="ResponsiveTabControlStyle" TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontFamily" Value="{StaticResource NormalFont}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        
        <Style x:Key="ResponsiveTabItemStyle" TargetType="TabItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Grid>
                            <Border x:Name="Border" 
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4,4,0,0">
                                <ContentPresenter x:Name="ContentSite"
                                                ContentSource="Header"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Margin="{TemplateBinding Padding}"/>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource ButtonAction}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#e3f2fd"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Additional Responsive Styles -->
        <Style x:Key="ResponsiveHeaderTextStyle" TargetType="TextBlock" BasedOn="{StaticResource HeaderTextStyle}">
            <Setter Property="FontSize" Value="18"/>
        </Style>
        
        <Style x:Key="ResponsiveNormalTextStyle" TargetType="TextBlock" BasedOn="{StaticResource NormalTextStyle}">
            <Setter Property="FontSize" Value="12"/>
        </Style>
        
        <Style x:Key="ResponsivePrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="15,8"/>
        </Style>
        
        <Style x:Key="ResponsiveSecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="15,8"/>
        </Style>
        
        <Style x:Key="ResponsiveDeleteButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="{StaticResource ButtonDelete}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="15,8"/>
        </Style>
        
        <Style x:Key="ResponsiveTextBoxStyle" TargetType="TextBox">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
        </Style>
        
        <Style x:Key="ResponsiveComboBoxStyle" TargetType="ComboBox">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
        </Style>
        
        <Style x:Key="ResponsiveCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="FontSize" Value="12"/>
        </Style>
        
        <Style x:Key="ResponsiveCasesListStyle" TargetType="ItemsControl">
            <Setter Property="Background" Value="Transparent"/>
        </Style>
        
        <Style x:Key="ResponsiveCaseCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BgLight}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style x:Key="ResponsiveCaseNumberStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
        </Style>
        
        <Style x:Key="ResponsiveCaseTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
        </Style>
        
        <Style x:Key="ResponsiveSearchCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BgCard}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="10"/>
        </Style>
        
        <Style x:Key="ResponsiveResultsSummaryStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{StaticResource TextSubtle}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </Window.Resources>
    
    <Grid x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" x:Name="HeaderBorder" Background="{StaticResource Header}" Height="60">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="نظام إدارة مشاكل العملاء - النسخة المحسنة" Style="{StaticResource ResponsiveHeaderTextStyle}" VerticalAlignment="Center" Margin="20,0"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,20,0">
                    <!-- Primary Actions -->
                    <Button Content="➕ إضافة حالة جديدة" 
                            Style="{StaticResource ResponsivePrimaryButtonStyle}" 
                            Margin="0,0,10,0" 
                            Click="AddButton_Click"
                            AutomationProperties.Name="إضافة حالة جديدة"
                            AutomationProperties.HelpText="إنشاء حالة جديدة للعميل"
                            AutomationProperties.AutomationId="AddCaseButton"
                            x:Name="AddButton">
                        <Button.ToolTip>
                            <ToolTip Content="إضافة حالة جديدة (Ctrl+N)"/>
                        </Button.ToolTip>
                    </Button>
                    <Button Content="🔍 البحث المتقدم" 
                            Style="{StaticResource ResponsiveSecondaryButtonStyle}" 
                            Margin="0,0,10,0" 
                            Click="AdvancedSearchButton_Click"
                            AutomationProperties.Name="البحث المتقدم"
                            AutomationProperties.HelpText="فتح نافذة البحث المتقدم"
                            AutomationProperties.AutomationId="AdvancedSearchButton"
                            x:Name="AdvancedSearchButton">
                        <Button.ToolTip>
                            <ToolTip Content="البحث المتقدم (F2)"/>
                        </Button.ToolTip>
                    </Button>
                    
                    <!-- Secondary Actions Menu -->
                    <Menu>
                        <MenuItem Header="⚙️ المزيد">
                            <MenuItem Header="🗑️ حذف الحالة" Click="DeleteButton_Click"/>
                            <MenuItem Header="👥 إدارة الموظفين" Click="ManageEmployeesButton_Click"/>
                            <MenuItem Header="️ عرض جميع الحالات" Click="ShowAllCases_Click"/>
                            <MenuItem Header="💾 نسخة احتياطية" Click="BackupButton_Click"/>
                            <MenuItem Header="🖨️ طباعة" Click="PrintButton_Click"/>
                            <MenuItem Header="📊 تصدير البيانات" Click="ExportButton_Click"/>
                            <MenuItem Header="📋 طباعة جميع الحالات" Click="PrintAllCasesButton_Click"/>
                            <MenuItem Header="️ معاينة الطباعة" Click="ShowPrintPreview_Click"/>
                            <MenuItem Header="العودة" Click="BackToDashboard_Click"/>
                            <Separator/>
                            <MenuItem Header="⚙️ الإعدادات" Click="SettingsButton_Click"/>
                            <MenuItem Header="❓ مساعدة" Click="HelpGuide_Click"/>
                            <MenuItem Header="ℹ️ حول" Click="About_Click"/>
                            <Separator/>
                            <MenuItem Header="خروج" Click="Exit_Click"/>
                        </MenuItem>
                    </Menu>
                </StackPanel>
                <TextBlock Grid.Column="2" x:Name="TimeLabel" Text=" 2024/01/01 00:00:00" Style="{StaticResource ResponsiveNormalTextStyle}" Foreground="White" VerticalAlignment="Center" Margin="0,0,20,0"/>
            </Grid>
        </Border>
        
        <!-- Main Content with Tabs -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Sidebar -->
            <Border Grid.Column="0" x:Name="SidebarBorder"
                    Background="{StaticResource BgCard}" 
                    BorderBrush="{StaticResource BorderLight}" 
                    BorderThickness="1"
                    CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <!-- Sidebar Header -->
                    <Border Grid.Row="0" Background="{StaticResource Header}" Height="50" CornerRadius="8,8,0,0">
                        <TextBlock Text="قائمة الحالات" Style="{StaticResource ResponsiveHeaderTextStyle}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Border>
                    
                    <!-- Enhanced Search Interface -->
                                                <Border Grid.Row="4" Style="{StaticResource ResponsiveSearchCardStyle}">
                        <StackPanel>
                            <!-- Quick Search -->
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox Grid.Column="0" 
                                         x:Name="QuickSearchBox"
                                         Style="{StaticResource ResponsiveTextBoxStyle}"
                                         TextChanged="QuickSearchBox_TextChanged"
                                         AutomationProperties.Name="البحث السريع"
                                         AutomationProperties.HelpText="اكتب للبحث في الحالات"
                                         AutomationProperties.AutomationId="QuickSearchBox"
                                         AutomationProperties.LabeledBy="{Binding ElementName=SearchLabel}"/>
                                
                                <Button Grid.Column="1" 
                                        Content="🔍" 
                                        Style="{StaticResource ResponsiveSecondaryButtonStyle}"
                                        Margin="5,0,0,0"
                                        Click="QuickSearchButton_Click"
                                        AutomationProperties.Name="بحث"
                                        AutomationProperties.HelpText="تنفيذ البحث"
                                        AutomationProperties.AutomationId="QuickSearchButton"
                                        x:Name="QuickSearchButton">
                                    <Button.ToolTip>
                                        <ToolTip Content="البحث (Ctrl+F)"/>
                                    </Button.ToolTip>
                                </Button>
                            </Grid>
                            
                            <!-- Advanced Filters (Collapsible) -->
                            <Expander Header="فلاتر متقدمة" IsExpanded="False">
                                <StackPanel>
                                    <!-- Advanced search controls -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                            <Label Content="حالة المشكلة" Style="{StaticResource NormalLabelStyle}"/>
                                            <ComboBox x:Name="StatusFilterComboBox" 
                                                      Style="{StaticResource ResponsiveComboBoxStyle}"
                                                      SelectionChanged="StatusFilterComboBox_SelectionChanged"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                            <Label Content="التصنيف" Style="{StaticResource NormalLabelStyle}"/>
                                            <ComboBox x:Name="CategoryFilterComboBox" 
                                                      Style="{StaticResource ResponsiveComboBoxStyle}"
                                                      SelectionChanged="CategoryFilterComboBox_SelectionChanged"/>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <!-- Year and Date Filters -->
                                    <Grid Margin="0,10,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                            <Label Content="السنة" Style="{StaticResource NormalLabelStyle}"/>
                                            <ComboBox x:Name="YearComboBox" 
                                                      SelectionChanged="YearComboBox_SelectionChanged"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                            <Label Content="نوع البحث" Style="{StaticResource NormalLabelStyle}"/>
                                            <ComboBox x:Name="SearchTypeComboBox" 
                                                      SelectionChanged="SearchTypeComboBox_SelectionChanged"/>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <!-- Sort Options -->
                                    <Grid Margin="0,10,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <Label Grid.Column="0" Content="ترتيب:" 
                                               Style="{StaticResource NormalLabelStyle}"
                                               VerticalAlignment="Center" 
                                               Margin="0,0,10,0"/>
                                        
                                        <ComboBox Grid.Column="1" 
                                                  x:Name="SortComboBox"
                                                  SelectionChanged="SortComboBox_SelectionChanged"/>
                                    </Grid>
                                </StackPanel>
                            </Expander>
                            
                            <!-- Search Results Summary -->
                            <TextBlock x:Name="SearchResultsSummary" 
                                       Text="تم العثور على 0 نتيجة"
                                       Style="{StaticResource ResponsiveResultsSummaryStyle}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Bulk Selection Controls -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" 
                                HorizontalAlignment="Right" 
                                Margin="15,5,15,5">
                        
                        <CheckBox x:Name="SelectAllCheckBox" 
                                  Content="تحديد الكل"
                                  Checked="SelectAllCheckBox_Checked"
                                  Unchecked="SelectAllCheckBox_Unchecked"/>
                        
                        <Button Content="🗑️ حذف المحدد" 
                                Style="{StaticResource ButtonStyle}"
                                Background="{StaticResource ButtonDelete}"
                                Margin="10,0,0,0"
                                Click="DeleteSelectedCases_Click"/>
                        
                        <Button Content="📊 تصدير المحدد" 
                                Style="{StaticResource ButtonStyle}"
                                Background="{StaticResource ButtonAction}"
                                Margin="10,0,0,0"
                                Click="ExportSelectedCases_Click"/>
                    </StackPanel>
                    
                    <!-- Cases List -->
                    <ListBox Grid.Row="3"
                             x:Name="CasesListBox"
                             Background="Transparent"
                             BorderThickness="0"
                             SelectionMode="Extended"
                             SelectionChanged="CasesListBox_SelectionChanged"
                             Margin="10,5,10,10">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource CaseCardStyle}" 
                                        MouseLeftButtonDown="CaseCard_Click">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Status Indicator -->
                                        <Ellipse Grid.Column="0" 
                                                 Width="12" Height="12" 
                                                 Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                                 Margin="0,0,10,0"/>
                                        
                                        <!-- Case Info -->
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding CustomerName}" 
                                                       FontWeight="Bold" 
                                                       FontSize="14"
                                                       Foreground="{StaticResource TextMain}"/>
                                            <TextBlock Text="{Binding SubscriberNumber}" 
                                                       Foreground="{StaticResource TextSubtle}"
                                                       FontSize="12"
                                                       Margin="0,2,0,0"/>
                                            <TextBlock Text="{Binding ProblemDescription}" 
                                                       TextTrimming="CharacterEllipsis"
                                                       Foreground="{StaticResource TextSubtle}"
                                                       FontSize="11"
                                                       Margin="0,4,0,0"
                                                       MaxHeight="32"
                                                       TextWrapping="Wrap"/>
                                            <StackPanel Orientation="Horizontal" 
                                                        Margin="0,6,0,0">
                                                <Border Background="{Binding Category.ColorCode, Converter={StaticResource ColorCodeToBrushConverter}}" 
                                                        CornerRadius="10" 
                                                        Padding="6,2">
                                                    <TextBlock Text="{Binding Category.CategoryName}" 
                                                               Foreground="White" 
                                                               FontSize="9"/>
                                                </Border>
                                                
                                                <Border Background="{Binding Status, Converter={StaticResource StatusToColorConverter}}" 
                                                        CornerRadius="10" 
                                                        Padding="6,2" 
                                                        Margin="4,0,0,0">
                                                    <TextBlock Text="{Binding Status}" 
                                                               Foreground="White" 
                                                               FontSize="9"/>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Quick Actions -->
                                        <StackPanel Grid.Column="2" 
                                                    Orientation="Horizontal" 
                                                    VerticalAlignment="Center">
                                            <Button Content="👁️" 
                                                    Style="{StaticResource QuickActionStyle}"
                                                    Click="QuickView_Click"
                                                    Tag="{Binding Id}"
                                                    ToolTip="عرض سريع"/>
                                            <Button Content="✏️" 
                                                    Style="{StaticResource QuickActionStyle}"
                                                    Click="QuickEdit_Click"
                                                    Tag="{Binding Id}"
                                                    ToolTip="تعديل سريع"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
            
            <!-- Separator -->
            <GridSplitter Grid.Column="1" 
                          Width="5" 
                          Background="{StaticResource BorderLight}"
                          HorizontalAlignment="Center"/>
            
            <!-- Main Content Area with Tabs -->
            <Border Grid.Column="2" 
                    Background="{StaticResource BgLight}" 
                    BorderBrush="{StaticResource BorderLight}" 
                    BorderThickness="1"
                    CornerRadius="8">
                <TabControl x:Name="MainTabControl" Style="{StaticResource ResponsiveTabControlStyle}">
                    
                    <!-- Cases Tab -->
                    <TabItem Header="📋 الحالات" x:Name="CasesTab" Style="{StaticResource ResponsiveTabItemStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Display Header -->
                            <Border Grid.Row="0" 
                                    Background="{StaticResource Header}" 
                                    Height="80" 
                                    CornerRadius="8,8,0,0">
                                <StackPanel VerticalAlignment="Center" 
                                            HorizontalAlignment="Center">
                                    <TextBlock x:Name="CaseNameLabel" 
                                               Text="اختر حالة من القائمة" 
                                               Style="{StaticResource HeaderTextStyle}"
                                               HorizontalAlignment="Center"/>
                                    <TextBlock x:Name="SolvedByLabel" 
                                               Text="" 
                                               Style="{StaticResource NormalTextStyle}"
                                               Foreground="{StaticResource TextSubtle}"
                                               HorizontalAlignment="Center" 
                                               Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Display Buttons -->
                            <Border Grid.Row="1" 
                                    Background="{StaticResource BgCard}" 
                                    Height="70">
                                <StackPanel Orientation="Horizontal" 
                                            HorizontalAlignment="Right" 
                                            VerticalAlignment="Center" 
                                            Margin="15">
                                    
                                    <Button Content="💾 حفظ التغييرات" 
                                            Style="{StaticResource ButtonStyle}"
                                            Background="{StaticResource ButtonSave}"
                                            Margin="0,0,15,0"
                                            Click="SaveButton_Click"
                                            AutomationProperties.Name="حفظ التغييرات"
                                            AutomationProperties.HelpText="حفظ التغييرات في الحالة الحالية"
                                            AutomationProperties.AutomationId="SaveButton"
                                            x:Name="SaveButton">
                                        <Button.ToolTip>
                                            <ToolTip Content="حفظ التغييرات (Ctrl+S)"/>
                                        </Button.ToolTip>
                                    </Button>
                                    
                                    <Button Content="🖨️ طباعة" 
                                            Style="{StaticResource ButtonStyle}"
                                            Background="{StaticResource ButtonAction}"
                                            Margin="0,0,15,0"
                                            Click="PrintButton_Click"
                                            AutomationProperties.Name="طباعة"
                                            AutomationProperties.HelpText="طباعة الحالة الحالية"
                                            AutomationProperties.AutomationId="PrintButton"
                                            x:Name="PrintButton">
                                        <Button.ToolTip>
                                            <ToolTip Content="طباعة (Ctrl+P)"/>
                                        </Button.ToolTip>
                                    </Button>
                                    
                                    <Button Content="🔄 إعادة تحميل" 
                                            Style="{StaticResource ButtonStyle}"
                                            Background="{StaticResource ButtonSecondary}"
                                            Margin="0,0,15,0"
                                            Click="RefreshButton_Click"
                                            AutomationProperties.Name="إعادة تحميل"
                                            AutomationProperties.HelpText="إعادة تحميل البيانات"
                                            AutomationProperties.AutomationId="RefreshButton"
                                            x:Name="RefreshButton">
                                        <Button.ToolTip>
                                            <ToolTip Content="إعادة تحميل (F5)"/>
                                        </Button.ToolTip>
                                    </Button>
                                    
                                    <Button Content="⚙️ الإعدادات" 
                                            Style="{StaticResource ButtonStyle}"
                                            Background="{StaticResource ButtonSecondary}"
                                            Click="SettingsButton_Click"
                                            AutomationProperties.Name="الإعدادات"
                                            AutomationProperties.HelpText="فتح إعدادات النظام"
                                            AutomationProperties.AutomationId="SettingsButton"
                                            x:Name="SettingsButton">
                                        <Button.ToolTip>
                                            <ToolTip Content="الإعدادات"/>
                                        </Button.ToolTip>
                                    </Button>
                                </StackPanel>
                            </Border>
                            
                                                        <!-- Case Details Content -->
                            <ScrollViewer Grid.Row="2" 
                                          VerticalScrollBarVisibility="Auto" 
                                          Margin="10">
                                <StackPanel>
                                    <TextBlock Text="اختر حالة من القائمة لعرض التفاصيل" 
                                               Style="{StaticResource NormalTextStyle}" 
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center" 
                                               Margin="0,50"/>
                                </StackPanel>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Customer Data Section -->
                                    <GroupBox Grid.Row="0" 
                                              Header="بيانات العميل" 
                                              Margin="0,0,0,20">
                                        <Grid Margin="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,10,0">
                                                <Label Content="اسم العميل: *" FontWeight="Bold" Foreground="{StaticResource TextMain}" x:Name="CustomerNameLabel"/>
                                                <TextBox x:Name="CustomerNameTextBox" 
                                                         Margin="0,0,0,10"
                                                         AutomationProperties.Name="اسم العميل"
                                                         AutomationProperties.HelpText="أدخل اسم العميل"
                                                         AutomationProperties.AutomationId="CustomerNameTextBox"
                                                         AutomationProperties.LabeledBy="{Binding ElementName=CustomerNameLabel}"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Grid.Row="0" Margin="10,0,0,0">
                                                <Label Content="رقم المشترك: *" FontWeight="Bold" Foreground="{StaticResource TextMain}" x:Name="SubscriberNumberLabel"/>
                                                <TextBox x:Name="SubscriberNumberTextBox" 
                                                         Margin="0,0,0,10"
                                                         AutomationProperties.Name="رقم المشترك"
                                                         AutomationProperties.HelpText="أدخل رقم المشترك"
                                                         AutomationProperties.AutomationId="SubscriberNumberTextBox"
                                                         AutomationProperties.LabeledBy="{Binding ElementName=SubscriberNumberLabel}"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,10,0">
                                                <Label Content="رقم الهاتف:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}" x:Name="PhoneLabel"/>
                                                <TextBox x:Name="PhoneTextBox" 
                                                         Margin="0,0,0,10"
                                                         AutomationProperties.Name="رقم الهاتف"
                                                         AutomationProperties.HelpText="أدخل رقم الهاتف"
                                                         AutomationProperties.AutomationId="PhoneTextBox"
                                                         AutomationProperties.LabeledBy="{Binding ElementName=PhoneLabel}"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Grid.Row="1" Margin="10,0,0,0">
                                                <Label Content="العنوان:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}" x:Name="AddressLabel"/>
                                                <TextBox x:Name="AddressTextBox" 
                                                         Margin="0,0,0,10"
                                                         AutomationProperties.Name="العنوان"
                                                         AutomationProperties.HelpText="أدخل عنوان العميل"
                                                         AutomationProperties.AutomationId="AddressTextBox"
                                                         AutomationProperties.LabeledBy="{Binding ElementName=AddressLabel}"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="0" Grid.Row="2" Margin="0,0,10,0">
                                                <Label Content="تصنيف المشكلة: *" FontWeight="Bold" Foreground="{StaticResource TextMain}" x:Name="CategoryLabel"/>
                                                <ComboBox x:Name="CategoryComboBox" 
                                                          Margin="0,0,0,10" 
                                                          DisplayMemberPath="CategoryName" 
                                                          SelectedValuePath="Id"
                                                          AutomationProperties.Name="تصنيف المشكلة"
                                                          AutomationProperties.HelpText="اختر تصنيف المشكلة"
                                                          AutomationProperties.AutomationId="CategoryComboBox"
                                                          AutomationProperties.LabeledBy="{Binding ElementName=CategoryLabel}"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Grid.Row="2" Margin="10,0,0,0">
                                                <Label Content="حالة المشكلة: *" FontWeight="Bold" Foreground="{StaticResource TextMain}" x:Name="CaseStatusLabel"/>
                                                <ComboBox x:Name="StatusComboBox" 
                                                          Margin="0,0,0,10" 
                                                          SelectionChanged="StatusComboBox_SelectionChanged"
                                                          AutomationProperties.Name="حالة المشكلة"
                                                          AutomationProperties.HelpText="اختر حالة المشكلة"
                                                          AutomationProperties.AutomationId="StatusComboBox"
                                                          AutomationProperties.LabeledBy="{Binding ElementName=CaseStatusLabel}"/>
                                            </StackPanel>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Problem Data Section -->
                                    <GroupBox Grid.Row="1" 
                                              Header="بيانات المشكلة" 
                                              Margin="0,0,0,20">
                                        <Grid Margin="10">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <StackPanel Grid.Row="0" Margin="0,0,0,10">
                                                <Label Content="وصف المشكلة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <TextBox x:Name="ProblemDescriptionTextBox" 
                                                         Height="80" 
                                                         TextWrapping="Wrap" 
                                                         AcceptsReturn="True" 
                                                         VerticalScrollBarVisibility="Auto"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Row="1" Margin="0,0,0,10">
                                                <Label Content="الإجراءات المتخذة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <TextBox x:Name="ActionsTakenTextBox" 
                                                         Height="80" 
                                                         TextWrapping="Wrap" 
                                                         AcceptsReturn="True" 
                                                         VerticalScrollBarVisibility="Auto"/>
                                            </StackPanel>
                                            
                                            <Grid Grid.Row="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                    <Label Content="آخر قراءة عداد:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                    <TextBox x:Name="LastMeterReadingTextBox" Margin="0,0,0,10"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                                    <Label Content="تاريخ آخر قراءة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                    <DatePicker x:Name="LastReadingDatePicker" Margin="0,0,0,10"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Financial Data Section -->
                                    <GroupBox Grid.Row="2" 
                                              Header="البيانات المالية" 
                                              Margin="0,0,0,20">
                                        <Grid Margin="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                <Label Content="المديونية:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <TextBox x:Name="DebtAmountTextBox" Margin="0,0,0,10"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                                <Label Content="تاريخ الاستلام: *" FontWeight="Bold" Foreground="{StaticResource TextMain}"/>
                                                <DatePicker x:Name="ReceivedDatePicker" Margin="0,0,0,10"/>
                                            </StackPanel>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Employee Data Section -->
                                    <GroupBox Grid.Row="3" 
                                              Header="بيانات الموظفين">
                                        <Grid Margin="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                <Label Content="أنشأ بواسطة: *" FontWeight="Bold" Foreground="{StaticResource TextMain}"/>
                                                <ComboBox x:Name="CreatedByComboBox" Margin="0,0,0,10" DisplayMemberPath="Name" SelectedValuePath="Id"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Margin="10,0">
                                                <Label Content="عدل بواسطة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <ComboBox x:Name="ModifiedByComboBox" Margin="0,0,0,10" DisplayMemberPath="Name" SelectedValuePath="Id"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="2" Margin="10,0,0,0">
                                                <Label Content="حل بواسطة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <ComboBox x:Name="SolvedByComboBox" Margin="0,0,0,10" DisplayMemberPath="Name" SelectedValuePath="Id"/>
                                            </StackPanel>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </ScrollViewer>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Problem Data Section -->
                                    <GroupBox Grid.Row="1" 
                                              Header="بيانات المشكلة" 
                                              Margin="0,0,0,20">
                                        <Grid Margin="10">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <StackPanel Grid.Row="0" Margin="0,0,0,10">
                                                <Label Content="وصف المشكلة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <TextBox x:Name="ProblemDescriptionTextBox" 
                                                         Height="80" 
                                                         TextWrapping="Wrap" 
                                                         AcceptsReturn="True" 
                                                         VerticalScrollBarVisibility="Auto"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Row="1" Margin="0,0,0,10">
                                                <Label Content="الإجراءات المتخذة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <TextBox x:Name="ActionsTakenTextBox" 
                                                         Height="80" 
                                                         TextWrapping="Wrap" 
                                                         AcceptsReturn="True" 
                                                         VerticalScrollBarVisibility="Auto"/>
                                            </StackPanel>
                                            
                                            <Grid Grid.Row="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                    <Label Content="آخر قراءة عداد:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                    <TextBox x:Name="LastMeterReadingTextBox" Margin="0,0,0,10"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                                    <Label Content="تاريخ آخر قراءة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                    <DatePicker x:Name="LastReadingDatePicker" Margin="0,0,0,10"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Financial Data Section -->
                                    <GroupBox Grid.Row="2" 
                                              Header="البيانات المالية" 
                                              Margin="0,0,0,20">
                                        <Grid Margin="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                <Label Content="مبلغ الدين:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <TextBox x:Name="DebtAmountTextBox" Margin="0,0,0,10"/>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                                <Label Content="حل بواسطة:" FontWeight="Bold" Foreground="{StaticResource TextSubtle}"/>
                                                <ComboBox x:Name="SolvedByComboBox" Margin="0,0,0,10" DisplayMemberPath="Name" SelectedValuePath="Id"/>
                                            </StackPanel>
                                        </Grid>
                                    </GroupBox>
                                    
                                    <!-- Attachments Section -->
                                    <GroupBox Grid.Row="3" 
                                              Header="المرفقات">
                                        <Grid Margin="10">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            
                                            <StackPanel Grid.Row="0" 
                                                        Orientation="Horizontal" 
                                                        HorizontalAlignment="Right" 
                                                        Margin="0,0,0,10">
                                                
                                                <Button Content="📎 إضافة مرفق" 
                                                        Style="{StaticResource ButtonStyle}"
                                                        Background="{StaticResource ButtonAction}"
                                                        Margin="0,0,10,0"
                                                        Click="AttachButton_Click"/>
                                                
                                                <Button Content="🗑️ حذف مرفق" 
                                                        Style="{StaticResource ButtonStyle}"
                                                        Background="{StaticResource ButtonDelete}"
                                                        Click="DeleteAttachmentButton_Click"/>
                                            </StackPanel>
                                            
                                            <DataGrid Grid.Row="1" 
                                                      x:Name="AttachmentsDataGrid"
                                                      AutoGenerateColumns="False"
                                                      IsReadOnly="True"
                                                      Height="200"
                                                      MouseDoubleClick="AttachmentsDataGrid_MouseDoubleClick">
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="اسم الملف" Binding="{Binding FileName}" Width="*"/>
                                                    <DataGridTextColumn Header="النوع" Binding="{Binding FileType}" Width="100"/>
                                                    <DataGridTextColumn Header="الوصف" Binding="{Binding Description}" Width="200"/>
                                                    <DataGridTextColumn Header="تاريخ الرفع" Binding="{Binding UploadDate, StringFormat=yyyy/MM/dd}" Width="120"/>
                                                    <DataGridTextColumn Header="رفع بواسطة" Binding="{Binding UploadedBy.Name}" Width="120"/>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </ScrollViewer>
                        </Grid>
                    </TabItem>
                        
                        <!-- Reports Tab -->
                        <TabItem Header="📊 التقارير" x:Name="ReportsTab" Style="{StaticResource ResponsiveTabItemStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Reports Header -->
                                <Border Grid.Row="0" Background="{StaticResource BgCard}" Height="50" CornerRadius="8,8,0,0">
                                    <TextBlock Text="التقارير والإحصائيات" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- Reports Content -->
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="10">
                                    <StackPanel>
                                        <TextBlock Text="قريباً - سيتم إضافة التقارير والإحصائيات" 
                                                   Style="{StaticResource NormalTextStyle}" 
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,50"/>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </TabItem>
                        
                        <!-- Settings Tab -->
                        <TabItem Header="⚙️ الإعدادات" x:Name="SettingsTab" Style="{StaticResource ResponsiveTabItemStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Settings Header -->
                                <Border Grid.Row="0" Background="{StaticResource BgCard}" Height="50" CornerRadius="8,8,0,0">
                                    <TextBlock Text="إعدادات التطبيق" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- Settings Content -->
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="10">
                                    <StackPanel>
                                        <TextBlock Text="قريباً - سيتم إضافة إعدادات التطبيق" 
                                                   Style="{StaticResource NormalTextStyle}" 
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,50"/>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </TabItem>
                        
                        <!-- Help Tab -->
                        <TabItem Header="❓ المساعدة" x:Name="HelpTab" Style="{StaticResource ResponsiveTabItemStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Help Header -->
                                <Border Grid.Row="0" Background="{StaticResource BgCard}" Height="50" CornerRadius="8,8,0,0">
                                    <TextBlock Text="المساعدة والدليل" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- Help Content -->
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="10">
                                    <StackPanel>
                                        <TextBlock Text="قريباً - سيتم إضافة دليل المستخدم والمساعدة" 
                                                   Style="{StaticResource NormalTextStyle}" 
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,50"/>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource BgCard}" 
                BorderBrush="{StaticResource BorderLight}" 
                BorderThickness="0,1,0,0"
                Height="30">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           x:Name="StatusLabel"
                           Text="جاهز" 
                           Style="{StaticResource NormalTextStyle}"
                           VerticalAlignment="Center" 
                           Margin="10,0"/>
                
                <TextBlock Grid.Column="1" 
                           x:Name="CasesCountLabel"
                           Text="الحالات: 0" 
                           Style="{StaticResource NormalTextStyle}"
                           VerticalAlignment="Center" 
                           Margin="0,0,10,0"/>
            </Grid>
        </Border>
    </Grid>
</Window>
